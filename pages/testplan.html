<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QA Test Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: Inter, sans-serif;
  background: #f7f8f5;
  margin: 0;
  padding: 24px;
  color: #1f2933;
}

h1 {
  font-size: 26px;
  margin-bottom: 20px;
}

h2 {
  font-size: 18px;
  margin: 24px 0 12px;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 24px;
  border-bottom: 1px solid #d6dad2;
  margin-bottom: 20px;
}
.tab {
  padding: 10px 0;
  cursor: pointer;
  font-weight: 600;
  color: #5f6f5a;
  border-bottom: 3px solid transparent;
}
.tab.active {
  border-color: #7a9c72;
  color: #1f2933;
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}

/* Feature accordion */
.feature {
  background: #ffffff;
  border: 1px solid #e1e4dd;
  border-radius: 8px;
  margin-bottom: 10px;
}

.feature-header {
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  background: #f2f4ef;
}

.feature-title {
  font-size: 16px;
  font-weight: 600;
}

.feature-meta {
  font-size: 13px;
  color: #5f6f5a;
  white-space: nowrap;
}

.feature-content {
  display: none;
  padding: 12px 16px 16px;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
th, td {
  padding: 8px;
  border-bottom: 1px solid #e5e7eb;
}
th {
  background: #fafafa;
  font-weight: 600;
}

/* Status pills */
.badge {
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}

.Automated { background: #e6f4ea; color: #1e4620; }
.Needs { background: #fff7cc; color: #665c00; }
.ToBeAutomated { background: #fdecc8; color: #7a4a00; }
.InProgress { background: #ede9fe; color: #4c1d95; }
.Cant { background: #fde2e2; color: #7f1d1d; }

/* Overall progress */
.overall {
  margin-bottom: 16px;
  padding: 12px 14px;
  background: #f2f4ef;
  border: 1px solid #e1e4dd;
  border-radius: 8px;
  font-size: 14px;
}
.overall strong {
  font-size: 18px;
  margin-right: 8px;
}
.overall span {
  color: #5f6f5a;
}

/* Milestone box */
.box {
  background: #fbfcfa;
  border: 1px solid #e3e7df;
  border-radius: 8px;
  padding: 16px;
}

/* Milestone table alignment + zebra rows */
#milestone-table th,
#milestone-table td {
  text-align: left;
  vertical-align: top;
}

#milestone-table tbody tr:nth-child(even) {
  background-color: #f4f6f2;
}

#milestone-table tbody tr:nth-child(odd) {
  background-color: #ffffff;
}

#milestone-table tbody tr:hover {
  background-color: #eef3ec;
}

</style>
</head>

<body>

<h1>QA Test Plan</h1>

<div class="tabs">
  <div class="tab active" data-tab="testplan">Test Plan</div>
  <div class="tab" data-tab="milestones">Milestones</div>
</div>

<!-- ================= TEST PLAN ================= -->
<div id="testplan" class="tab-content active">

  <div id="overall"></div>

  <div id="features"></div>

</div>

<!-- ================= MILESTONES ================= -->
<div id="milestones" class="tab-content">

  <div id="milestoneProgress"></div>

  <div class="box">
    <h2>Milestones</h2>
    <table id="milestone-table">
      <thead>
        <tr>
          <th>Milestone</th>
          <th>Activity</th>
          <th>Status</th>
          <th>Comments</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script>
const TESTPLAN_CSV = "../data/testplan.csv";
const MILESTONE_CSV = "../data/milestones.csv";

/* Tabs logic */
document.querySelectorAll(".tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
  };
});

function cls(status) {
  return (status || "").replace(/\s+/g, "").replace("Can't", "Cant");
}

/* ================= TEST PLAN LOGIC (RESTORED) ================= */

fetch(TESTPLAN_CSV)
  .then(r => r.text())
  .then(csv => {

    const rows = Papa.parse(csv, {
      header: true,
      delimiter: "|",
      skipEmptyLines: true
    }).data;

    const grouped = {};
    let totalTests = 0;
    let automatedTests = 0;

    rows.forEach(row => {

      const feature = row.Feature || "Other";

      if (!grouped[feature]) {
        grouped[feature] = [];
      }

      grouped[feature].push(row);
      totalTests++;

      if (row.Status === "Automated") {
        automatedTests++;
      }
    });

    const featuresContainer = document.getElementById("features");

    Object.keys(grouped).forEach(feature => {

      const tests = grouped[feature];
      const automated = tests.filter(t => t.Status === "Automated").length;
      const percent = Math.round((automated / tests.length) * 100);

      const featureBox = document.createElement("div");
      featureBox.className = "feature";

      const header = document.createElement("div");
      header.className = "feature-header";

      header.innerHTML = `
        <div class="feature-title">${feature}</div>
        <div class="feature-meta">${percent}% automated (${automated}/${tests.length})</div>
      `;

      const content = document.createElement("div");
      content.className = "feature-content";

      content.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>TCID</th>
              <th>Description</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            ${tests.map(t => `
              <tr>
                <td>${t.TCID || ""}</td>
                <td>${t["Test Case Description"] || ""}</td>
                <td><span class="badge ${cls(t.Status)}">${t.Status}</span></td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;

      header.onclick = () => {
        content.style.display = content.style.display === "block" ? "none" : "block";
      };

      featureBox.appendChild(header);
      featureBox.appendChild(content);
      featuresContainer.appendChild(featureBox);
    });

    const overallPercent = Math.round((automatedTests / totalTests) * 100);

    document.getElementById("overall").innerHTML = `
      <div class="overall">
        <strong>${overallPercent}%</strong>
        Overall Automation Progress
        <span>(${automatedTests} of ${totalTests} test cases automated)</span>
      </div>
    `;
  });

/* ================= MILESTONES LOGIC ================= */

fetch(MILESTONE_CSV)
  .then(r => r.text())
  .then(csv => {

    const rows = Papa.parse(csv, {
      header: true,
      skipEmptyLines: true
    }).data;

    const tbody = document.querySelector("#milestone-table tbody");
    const progress = {};

    rows.forEach(row => {

      const q = row.Milestone || "Other";

      if (!progress[q]) {
        progress[q] = { total: 0, achieved: 0 };
      }

      progress[q].total++;
      if (row.Status === "Achieved") {
        progress[q].achieved++;
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.Milestone || "-"}</td>
        <td>${row.Activity || "-"}</td>
        <td>${row.Status || "-"}</td>
        <td>${row.Comments || "-"}</td>
      `;
      tbody.appendChild(tr);
    });
  });
</script>

</body>
</html>
