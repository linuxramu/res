<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>QA Test Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: Inter, sans-serif;
  background: #f7f7f5;
  margin: 0;
  padding: 24px;
  color: #1f2933;
}

h1 { font-size: 28px; margin-bottom: 16px; }
h2 { font-size: 18px; margin: 24px 0 12px; }

/* Tabs */
.tabs {
  display: flex;
  gap: 28px;
  border-bottom: 1px solid #d1d5db;
  margin-bottom: 24px;
}
.tab {
  padding: 10px 0;
  cursor: pointer;
  font-weight: 600;
  color: #4b5563;
  border-bottom: 3px solid transparent;
}
.tab.active {
  border-color: #5a7f4f;
  color: #1f2933;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* Coverage tiles */
.coverage-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 16px;
  margin-bottom: 28px;
}
.coverage-tile {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-left: 6px solid #5a7f4f;
  border-radius: 10px;
  padding: 16px;
}
.coverage-title {
  font-weight: 600;
  font-size: 16px;
}
.coverage-value {
  font-size: 22px;
  font-weight: 600;
  margin-top: 6px;
}
.coverage-sub {
  font-size: 13px;
  color: #6b7280;
}

/* Feature accordion */
.feature {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  margin-bottom: 12px;
}
.feature-header {
  padding: 16px 18px;
  font-size: 17px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  background: #f4f6f3;
}
.feature-content {
  display: none;
  padding: 14px 18px 18px;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #e5e7eb;
  text-align: left;
}
th { background: #fafafa; }

/* Status badges */
.badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}
.Automated { background: #e6f4ea; color: #1e4620; }
.Needs { background: #fff7cc; color: #665c00; }
.ToBeAutomated { background: #fdecc8; color: #7a4a00; }
.InProgress { background: #ede9fe; color: #4c1d95; }
.Cant { background: #fde2e2; color: #7f1d1d; }

/* Flashy overall milestone banner */
.overall-banner {
  background: linear-gradient(135deg, #5a7f4f, #7ea870);
  color: #ffffff;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 28px;
}
.overall-banner h2 {
  margin: 0 0 10px;
  font-size: 20px;
}
.overall-value {
  font-size: 34px;
  font-weight: 600;
}
.overall-sub {
  opacity: 0.9;
  font-size: 14px;
}

/* Milestone table box */
.box {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 16px;
}
</style>
</head>

<body>

<h1>ðŸ“‹ QA Test Plan</h1>

<div class="tabs">
  <div class="tab active" data-tab="testplan">Test Plan</div>
  <div class="tab" data-tab="milestones">Milestones</div>
</div>

<!-- ================= TEST PLAN ================= -->
<div id="testplan" class="tab-content active">
  <div id="coverage" class="coverage-grid"></div>
  <div id="features"></div>
</div>

<!-- ================= MILESTONES ================= -->
<div id="milestones" class="tab-content">
  <div id="overall"></div>

  <div class="box">
    <h2>Milestones</h2>
    <table id="milestone-table">
      <thead>
        <tr>
          <th>Milestone</th>
          <th>Target</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const TESTPLAN_CSV = "../data/testplan.csv";
const MILESTONE_CSV = "../data/milestones.csv";

/* Tabs */
document.querySelectorAll(".tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".tab, .tab-content")
      .forEach(e => e.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
  };
});

function normalizeStatus(s) {
  return (s || "").replace(/\s+/g, "").replace("Can't", "Cant");
}

/* Load Test Plan */
fetch(TESTPLAN_CSV).then(r => r.text()).then(csv => {
  const data = Papa.parse(csv, {
    header: true,
    delimiter: "|",
    skipEmptyLines: true
  }).data;

  const grouped = {};
  let total = 0, automated = 0;

  data.forEach(r => {
    const f = r.Feature || "Other";
    grouped[f] = grouped[f] || [];
    grouped[f].push(r);
    total++;
    if (r.Status === "Automated") automated++;
  });

  /* Coverage tiles */
  const coverage = document.getElementById("coverage");
  Object.entries(grouped).forEach(([f, tests]) => {
    const auto = tests.filter(t => t.Status === "Automated").length;
    const pct = Math.round((auto / tests.length) * 100);
    coverage.innerHTML += `
      <div class="coverage-tile">
        <div class="coverage-title">${f}</div>
        <div class="coverage-value">${pct}% Automated</div>
        <div class="coverage-sub">${auto}/${tests.length} test cases</div>
      </div>`;
  });

  /* Feature accordions */
  const container = document.getElementById("features");
  Object.entries(grouped).forEach(([f, tests]) => {
    const box = document.createElement("div");
    box.className = "feature";

    const header = document.createElement("div");
    header.className = "feature-header";
    header.innerHTML = `${f} <span>${tests.length} tests</span>`;

    const content = document.createElement("div");
    content.className = "feature-content";
    content.innerHTML = `
      <table>
        <thead>
          <tr><th>TCID</th><th>Description</th><th>Status</th></tr>
        </thead>
        <tbody>
          ${tests.map(t => `
            <tr>
              <td>${t.TCID || ""}</td>
              <td>${t["Test Case Description"] || ""}</td>
              <td><span class="badge ${normalizeStatus(t.Status)}">${t.Status}</span></td>
            </tr>`).join("")}
        </tbody>
      </table>`;

    header.onclick = () =>
      content.style.display = content.style.display === "block" ? "none" : "block";

    box.append(header, content);
    container.appendChild(box);
  });

  /* Overall automation banner */
  const pct = Math.round((automated / total) * 100);
  document.getElementById("overall").innerHTML = `
    <div class="overall-banner">
      <h2>Overall Automation Progress</h2>
      <div class="overall-value">${pct}%</div>
      <div class="overall-sub">${automated} of ${total} test cases automated</div>
    </div>`;
});

/* Load milestones */
fetch(MILESTONE_CSV).then(r => r.text()).then(csv => {
  const rows = Papa.parse(csv, { header: true, skipEmptyLines: true }).data;
  const tbody = document.querySelector("#milestone-table tbody");
  rows.forEach(r => {
    tbody.innerHTML += `
      <tr>
        <td><strong>${r.Milestone}</strong></td>
        <td>${r.Target}</td>
        <td>${r.Notes}</td>
      </tr>`;
  });
});
</script>

</body>
</html>
