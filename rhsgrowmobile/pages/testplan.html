<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QA Test Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: Inter, sans-serif;
  background: #f7f8f5;
  margin: 0;
  padding: 24px;
  color: #1f2933;
}

h1 {
  font-size: 26px;
  margin-bottom: 20px;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 24px;
  border-bottom: 1px solid #d6dad2;
  margin-bottom: 20px;
}
.tab {
  padding: 10px 0;
  cursor: pointer;
  font-weight: 600;
  color: #5f6f5a;
  border-bottom: 3px solid transparent;
}
.tab.active {
  border-color: #7a9c72;
  color: #1f2933;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* ===== Priority Summary ===== */
.priority-summary {
  background: linear-gradient(180deg, #ffffff, #f9faf7);
  border: 1px solid #e1e4dd;
  border-radius: 12px;
  padding: 14px 18px;
  margin-bottom: 18px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.priority-item {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 8px 14px;
  font-size: 13px;
  font-weight: 600;
  color: #1f2933;
  display: flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.priority-item span {
  font-weight: 600;
  color: #374151;
}

/* Priority emphasis */
.priority-item:nth-child(1) { border-left: 4px solid #b91c1c; }
.priority-item:nth-child(2) { border-left: 4px solid #d97706; }
.priority-item:nth-child(3) { border-left: 4px solid #2563eb; }
.priority-item:nth-child(4) { border-left: 4px solid #059669; }
.priority-item:last-child {
  border-left: 4px solid #6b7280;
  background: #f9fafb;
}

/* Accordion */
.feature {
  background: #ffffff;
  border: 1px solid #e1e4dd;
  border-radius: 10px;
  margin-bottom: 10px;
}
.feature-header {
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  background: #f2f4ef;
  border-bottom: 1px solid #e1e4dd;
  transition: background 0.2s ease;
}
.feature-header:hover {
  background: #eef2ec;
}
.feature-title {
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}
.feature-meta {
  font-size: 13px;
  color: #5f6f5a;
  font-weight: 500;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
th, td {
  padding: 8px;
  border-bottom: 1px solid #e5e7eb;
}
th {
  background: #fafafa;
  font-weight: 600;
}
tbody tr:nth-child(even) {
  background: #f4f6f2;
}

/* Badges */
.badge {
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}
.Automated { background: #e6f4ea; color: #1e4620; }
.ReadyToAutomate { background: #fdecc8; color: #7a4a00; }
.InProgress { background: #ede9fe; color: #4c1d95; }
.CantBeAutomated { background: #fde2e2; color: #7f1d1d; }
.None { background: #f3f4f6; color: #374151; }
.Undefined { background: #fee2e2; color: #991b1b; }

/* Summary colors */
.summary-automated-zero {
  color: #6b7280;
  font-weight: 600;
}
.summary-automated-nonzero {
  color: #1e4620;
  font-weight: 600;
}
.summary-ready {
  color: #7a4a00;
  font-weight: 600;
}

/* Chevron */
.chevron {
  margin-right: 6px;
  color: #6b7b67;
}
.feature.open .chevron {
  transform: rotate(90deg);
}
</style>
</head>

<body>

<h1>QA Test Plan</h1>

<div class="tabs">
  <div class="tab active">Test Coverage</div>
</div>

<div id="testplan" class="tab-content active">
  <div id="priority-summary"></div>
  <div id="features"></div>
</div>

<script>
const TESTPLAN_CSV = "../data/testplan.csv";

function normalizeStatus(raw) {
  if (!raw || raw.toString().trim() === "") return "None";
  const s = raw.toString().trim().toLowerCase().replace(/\s+/g, "").replace("'", "");
  if (s === "automated") return "Automated";
  if (s === "readytoautomate") return "ReadyToAutomate";
  if (s === "inprogress") return "InProgress";
  if (s === "cantbeautomated") return "CantBeAutomated";
  return "Undefined";
}

const STATUS_LABEL = {
  Automated: "Automated",
  ReadyToAutomate: "Ready To Automate",
  InProgress: "In Progress",
  CantBeAutomated: "Can't Be Automated",
  None: "None",
  Undefined: "Undefined"
};

fetch(TESTPLAN_CSV)
.then(r => r.text())
.then(csv => {
  const rows = Papa.parse(csv, {
    header: true,
    delimiter: "|",
    skipEmptyLines: true
  }).data;

  /* Priority summary */
  const priorityStats = {};
  let totalAll = 0;
  let totalAutomated = 0;

  rows.forEach(r => {
    const p = (r.Priority || "Undefined").trim();
    const s = normalizeStatus(r.Status);
    priorityStats[p] = priorityStats[p] || { total: 0, automated: 0 };
    priorityStats[p].total++;
    totalAll++;
    if (s === "Automated") {
      priorityStats[p].automated++;
      totalAutomated++;
    }
  });

  const order = ["Critical", "High", "Medium", "Low"];
  const summary = document.getElementById("priority-summary");

  order.forEach(p => {
    if (!priorityStats[p]) return;
    const { total, automated } = priorityStats[p];
    const pct = Math.round((automated / total) * 100);
    summary.innerHTML += `
      <div class="priority-item">
        ${p}: <span>${automated}/${total} – ${pct}%</span>
      </div>`;
  });

  const totalPct = Math.round((totalAutomated / totalAll) * 100);
  summary.innerHTML += `
    <div class="priority-item">
      Total: <span>${totalAutomated}/${totalAll} – ${totalPct}%</span>
    </div>`;

  /* Feature grouping */
  const grouped = {};
  rows.forEach(r => {
    const f = r.Feature || "Other";
    grouped[f] = grouped[f] || [];
    grouped[f].push(r);
  });

  const container = document.getElementById("features");

  Object.keys(grouped).forEach((feature, i) => {
    const serial = String(i + 1).padStart(2, "0");
    const tests = grouped[feature];
    const total = tests.length;

    let automated = 0;
    let ready = 0;

    tests.forEach(t => {
      const st = normalizeStatus(t.Status);
      if (st === "Automated") automated++;
      if (st === "ReadyToAutomate") ready++;
      t._normalizedStatus = st;
    });

    const pct = Math.round((automated / total) * 100);
    const cls = pct > 0 ? "summary-automated-nonzero" : "summary-automated-zero";

    const summaryTxt = `
      <span class="${cls}">
        ${automated}/${total} Automated (${pct}%)
      </span>
      ${ready > 0 ? ` | <span class="summary-ready">${ready}/${total} ReadyToAutomate</span>` : ""}
    `;

    const box = document.createElement("div");
    box.className = "feature";

    const header = document.createElement("div");
    header.className = "feature-header";
    header.innerHTML = `
      <div class="feature-title">
        <span class="chevron">▸</span>${serial} - ${feature}
      </div>
      <div class="feature-meta">${summaryTxt}</div>
    `;

    const content = document.createElement("div");
    content.style.display = "none";
    content.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>TCID</th>
            <th>Description</th>
            <th>Type</th>
            <th>Priority</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          ${tests.map(t => `
            <tr>
              <td>${t.TCID || ""}</td>
              <td>${t["Test Case Description"] || ""}</td>
              <td>${t.Type || "-"}</td>
              <td>${t.Priority || "-"}</td>
              <td>
                <span class="badge ${t._normalizedStatus}">
                  ${STATUS_LABEL[t._normalizedStatus]}
                </span>
              </td>
            </tr>`).join("")}
        </tbody>
      </table>
    `;

    header.onclick = () => {
      const open = content.style.display === "block";
      content.style.display = open ? "none" : "block";
      box.classList.toggle("open", !open);
    };

    box.append(header, content);
    container.appendChild(box);
  });
});
</script>

</body>
</html>
